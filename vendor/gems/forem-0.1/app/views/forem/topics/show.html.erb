<link rel="stylesheet" href="/assets/website.css" type="text/css" media="screen"/>

<style type="text/css">


  #closeReply{
    display:none;
    position:fixed;
    top:0%;
    left:96.5%;
    z-index:1000;
  }
   #replyBox{
    background-color:#848484;
    border:5px solid #BBC;
    display:none;
    position:fixed;
    width:90%;
    height:90%;
    padding:2%;
    top:0%;
    left:3%;
    z-index:999;
   }
   #locking_screen{
    background-color:#F2F2F2;
    display:none;
    position:fixed;
    width:100%;
    height:50em;
    top:0;
    left:0;
    opacity:.75;
    z-index:1001;
   }
</style>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="/assets/jquery.tinyscrollbar.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
$('#scrollbar1').tinyscrollbar();	
$("#closeReply").click(function(){
 $("#replyBox, #closeReply").css("display","none");
});
});
</script>	
<div id='topic' class='<%= @topic.locked? ? 'locked' : 'unlocked' %>'>
  <%= render :partial => 'forem/topics/head', :locals => { :topic => @topic } %>
  <menu>
    <%# if @topic.can_be_replied_to? %>
      <%#= link_to t(".reply"), '#', :onclick=>"show('#{new_topic_post_path(@topic)}','')" %>
    <%# end %>
    <% if @topic.user == forem_user || forem_admin? %>
      | <%= link_to t(".delete"), forum_topic_path(@forum, @topic), :method => :delete, :confirm => 'Are you sure?' %>
    <% end %>
  </menu> 

  <% if forem_admin? %>
    <%= link_to t(".hide.#{@topic.hidden}"), toggle_hide_admin_topic_path(@topic), :method => :put %> | 
    <%= link_to t(".lock.#{@topic.locked}"), toggle_lock_admin_topic_path(@topic), :method => :put %> |
    <%= link_to t(".pin.#{@topic.pinned}"), toggle_pin_admin_topic_path(@topic), :method => :put %>
  <% end %>
  <%= paginate @posts %>

<div id="scrollbar1">
<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>
<div class="viewport">
<div class="overview">
<div id='posts'>
 <%= render :partial => "forem/posts/post", :collection => @posts %>
</div>
 </div>
</div>
</div>
<!-- new code -->
  <!-- for show reply box(show textarea for comment) -->
  <span id="closeReply"><%= image_tag '/assets/close.png' %></span>
  <div id="replyBox"></div>
</div>

<div id="locking_screen">
  <h1 style="position:absolute;top:51%;left:48%;">Processing...</h1>
</div>

<div id="waiting" style="display:none;position:absolute;top:60%;left:50%;z-index:1002">
  <%=image_tag "/assets/ajax-loader.gif", :style=>"margin:-45% 0 0 50%" %>
</div>
<!-- new code -->
<!-- to show reply messages through ajax -->
<script type="text/javascript">
function show(loc,rplyId)	// this loc and rplyId send by forem/posts/post page's this link <li><%#= link_to "Reply", '#', :onclick=>"show('#{new_topic_post_path(@topic)}','?reply_to_id=#{post.id}')" %></li>
{
  $.ajax({
  type : "GET",
  url : loc+""+rplyId,
  dataType : "html",
      success: function(data) {
      data=takeReplyForm(data);
      $("#replyBox").html(data);
$("#replyBox, #closeReply").css("display","block");
},
      error : function() {
alert("Sorry, page not found.");
      }
    });
}
function takeReplyForm(data)
{
return(data.substring(data.indexOf("<h2>Post reply</h2>")+("<h2>Post reply</h2>").length+1,data.lastIndexOf("</form>")+("</form>").length));
}
function uploadComment()
{
 //if textarea empty
 
 if($("#post_text").val()=="")
 {
   return;
 }
 $("#locking_screen").css("display","block");
 $("#waiting").css("display","block"); //show waiting icon when comment submit
 $("#replyComment").attr("disabled", "disabled");  //disable button when comment submit
 $("#replyBox, #closeReply").css("display","none");

 jQuery.ajax({
       type : "POST",	
       url : $("#new_forem_post").attr("action"),
data: $("#new_forem_post").serialize(),
       dataType : "html",
       success: function(data) 
{
$("#waiting").css("display","none");
  $("#post_text").val("");    //empty textarea field
  $("#replyComment").removeAttr("disabled");
  $("#locking_screen").css("display","none");
  //reload comments
  reloadPage("<%=request.url%>");
        },
        error : function() 
{
             alert("Sorry, The requested property could not be found.");
        }
   });
 return false;
}
function reloadPage(href)
{
 $("body").load(href);
  }	
</script>
			
