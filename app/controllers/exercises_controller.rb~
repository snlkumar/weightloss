class ExercisesController < ApplicationController
  before_filter :authenticate_user!
  
  def search
    terms     = params[:term].split(/,|\s/).reject(&:blank?)
    # category LIKE :#{in_words} OR 
    conds     = terms.enum_with_index.map{|t, index| in_words = index.to_s.en.numwords; "description LIKE :#{in_words}"}.join(' AND ')
    term_hash = {}
    
    terms.each_with_index{|term, index| term_hash[index.to_s.en.numwords.to_sym] = "%#{term}%"}
    
    @exercises = Exercise.find(:all, :conditions => [conds, term_hash])
    
    #render :json => @exercises.map{|f| {:value => "#{f.description} - #{f.calories} Cal/Hr", :id => f.id} }.to_json
    
    ##
    @weight = (self.current_user ? self.current_user.weight : User.find(self.current_user.id).weight ) * 0.45
    ##
    render :json => @exercises.map{|f| {:value => "#{f.description} @$% #{f.mets ? (60*f.mets*3.5*@weight/200) : (0)} Cal/Hr", :id => f.id} }.to_json
    # to split data this (@$%) sign base in dairy.html.erb page
  end
  
  def workout_item_calories
    workout_item = WorkoutItem.new(params[:meal][:workout_items_attributes].first.last)
    render :json => {:calories => workout_item.calories}
  end
end
